<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <!-- <link rel="stylesheet" content="text/css" href="https://raw.githubusercontent.com/dishajk/dishajk.github.io/master/assets/css/styles.css"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <title>Calendar Setup</title>
</head>
<body class="container">
  <h1 class="my-3">Calendar</h1>

  <form id="calendarForm" class="row g-3">
      <div class="col-md-3">
        <label class="form-label">
        Year:
        <input class="form-control" type="number" id="yearInput" min="2000" max="2100" required>
        </label>
      </div>
      <div class="col-md-3">
        <label>
        Month:
        <input class="form-control" type="number" id="monthInput" min="1" max="12" required>
        </label>
      </div>
    <div class="col-md-3">
        <button type="button" class="btn btn-primary"id="setMonth">Set Month</button>
    </div>
  </form>
  <div id="monthDisplay" class="my-3"></div>

  <h2 class="my-2">Holidays</h2>
  <div class="container-fluid">
    <label for="holidayInput" class="form-label">Pick a date:</label>
    <input type="date" id="holidayInput" class="form-control">
    <button type="button" id="addHoliday" class="btn btn-primary">Add Holiday</button>
  </div>
  <h3>Selected Holidays</h3>
  <ul id="holidayList"></ul>

  <h2>Events</h2>
  <div>
    <label for="eventDateInput" class="form-label">Date:</label>
    <input type="date" id="eventDateInput" class="form-control">
    <label for="eventNameInput" class="form-label">Event:</label>
    <input type="text" id="eventNameInput" class="form-control" placeholder="Enter event name">
    <button type="button" id="addEvent" class="btn btn-primary">Add Event</button>
  </div>
<h3>Selected Events</h3>
  <ul id="eventList"></ul>
<button id="generateBtn" type="button" class="btn btn-primary">Generate Calendar PDF</button>
  <div id="status"></div>
  <script>
    // DOM references
    const now = new Date();
    const yearInput = document.getElementById("yearInput");
    const monthInput = document.getElementById("monthInput");
    const monthDisplay = document.getElementById("monthDisplay");
    const holidayInput = document.getElementById("holidayInput");
    const eventDateInput = document.getElementById("eventDateInput");
    const holidayList = document.getElementById("holidayList");
    const eventList = document.getElementById("eventList");
    const statusBox = document.getElementById("status");

    const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    // Data stores
    let holidays = [];
    let events = [];

    // Default to current year and month
    yearInput.value = now.getFullYear();
    monthInput.value = now.getMonth() + 1;

    function setPickerMonth() {
      const y = parseInt(yearInput.value);
      const m = parseInt(monthInput.value);
      const firstDay = `${y}-${String(m).padStart(2, '0')}-01`;
      const lastDay = new Date(y, m, 0).getDate();
      const maxDay = `${y}-${String(m).padStart(2, '0')}-${String(lastDay).padStart(2, '0')}`;
      // Set bounds for both pickers
      for (const picker of [holidayInput, eventDateInput]) {
        picker.min = firstDay;
        picker.max = maxDay;
        picker.value = firstDay;
      }
      monthDisplay.textContent = `Selected month:  ${monthNames[m - 1]} ${y}`;
    }

    document.getElementById("setMonth").addEventListener("click", setPickerMonth);
    setPickerMonth(); // initialize

    // --- Holidays ---
    document.getElementById("addHoliday").addEventListener("click", () => {
      const date = holidayInput.value;
      if (!date) return;
      if (!holidays.includes(date)) {
        holidays.push(date);
        const li = document.createElement("li");
        li.textContent = date;
        const del = document.createElement("button");
        del.textContent = "✕";
        del.onclick = () => {
          holidays = holidays.filter(d => d !== date);
          li.remove();
        };
        li.appendChild(del);
        holidayList.appendChild(li);
      }
      console.log("Holidays:", holidays);
    });

    // --- Events ---
    document.getElementById("addEvent").addEventListener("click", () => {
      const date = eventDateInput.value;
      const name = eventNameInput.value.trim();
      if (!date || !name) return;
      const eventObj = { date, name };
      events.push(eventObj);

      const li = document.createElement("li");
      li.innerHTML = `<strong>${date}</strong>: ${name}`;
      const del = document.createElement("button");
      del.textContent = "✕";
      del.style.marginLeft = "1em";
      del.onclick = () => {
        events = events.filter(e => !(e.date === date && e.name === name));
        li.remove();
      };
      li.appendChild(del);
      eventList.appendChild(li);
      document.getElementById("eventNameInput").value = "";
      console.log("Events:", events);
    });
        // --- Generate PDF (simulate for now) ---
    document.getElementById("generateBtn").addEventListener("click", async () => {
      const payload = {
        year: parseInt(yearInput.value),
        month: parseInt(monthInput.value),
        holidays,
        events
      };
      statusBox.textContent = "Preparing PDF...";
      console.log("Payload to send:", payload);

      // TODO: Later, this will trigger GitHub Action
      // For now, just simulate a delay
      await new Promise(r => setTimeout(r, 1000));
      statusBox.textContent = "Data ready to send to GitHub Action (PDF generation next)";
    });
  </script>
</body>
</html>